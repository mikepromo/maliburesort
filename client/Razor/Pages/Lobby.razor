@page "/lobby"
@using shared
@inject AppState AppState
@implements IDisposable

<div class="terminal-window" style="height: 100%;">
    <div class="terminal-header">NETWORK NODES / AVAILABLE TABLES</div>
    <div style="padding: 10px; overflow-y: auto;">
        <table style="width: 100%; border-collapse: collapse; text-align: left;">
            <thead>
            <tr style="color: #666; font-size: 11px; border-bottom: 1px solid #333;">
                <th style="padding: 8px;">INDEX</th>
                <th>TABLE NAME</th>
                <th>TIER</th>
                <th>CAPACITY</th>
                <th style="text-align: right;">MIN BET</th>
            </tr>
            </thead>
            <tbody>
            @if (tables == null)
            {
                //todo: render loading
            }
            else
            {
                int idx = 1;
                @foreach (TableDto t in tables)
                {
                    <tr style="border-bottom: 1px solid #111; font-size: 14px;">
                        <td style="padding: 8px; color: var(--amber);">@idx</td>
                        <td style="font-weight: bold;">@t.Name.ToUpper()</td>
                        <td><span style="color: #888;">[@t.Tier]</span></td>
                        <td>@t.PlayerCount / @t.MaxSeats</td>
                        <td style="text-align: right;" class="text-green">$@t.MinBet.ToString("N0")</td>
                    </tr>
                    idx++;
                }
            }
            </tbody>
        </table>

        <div style="margin-top: 20px; color: #444; font-size: 12px;">
            >> USE 'JOIN [INDEX]' TO CONNECT TO A NODE
        </div>
    </div>
</div>

@code
{
    List<TableDto>? tables => AppState?.LobbyContext?.Tables;
    
    protected override async Task OnInitializedAsync()
    {
        AppState.OnChange += StateHasChanged;
        await AppState.RefreshLobby();
    }

    public void Dispose()
    {
        AppState.OnChange -= StateHasChanged;
    }
}
